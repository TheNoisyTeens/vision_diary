## 非极大值抑制（Non-Maximum Suppression）分析
>在常见的边缘检测算子或轮廓检测相关算法中都有非极大值抑制这一步，本文将介绍Canny算法中的非极大值抑制，Canny算子中的非极大值抑制是指沿着梯度方向上进行非极大值的抑制。

在代码中，有几个if-else需要注意。在John Canny提出的Canny算子的论文中，非最大值抑制就只是在0、90、45、135四个梯度方向上进行的，每个像素点梯度方向按照相近程度用这四个方向来代替。这种情况下，非最大值抑制所比较的相邻两个像素就是：
* 0：左边 和 右边
* 45：右上 和 左下

* 90： 上边 和 下边      

* 135： 左上 和 右下 

>这样做的好处是简单， 但是这种简化的方法无法达到最好的效果， 因为，自然图像中的边缘梯度方向不一定是沿着这四个方向的。因此，就有很大的必要进行插值，找出在一个像素点上最能吻合其所在梯度方向的两侧的像素值。

然而，实际数字图像中的像素点是离散的二维矩阵，所以处在真正中心位置C处的梯度方向两侧的点是不一定存在的，或者说是一个亚像素(sub pixel)点，而这个不存在的点， 以及这个点的梯度值就必须通过对其两侧的点进行插值来得到。

对于代码，如果|gy|>|gx|，这说明该点的梯度方向更靠近Y轴方向，所以g2和g4则在C的上下，我们可以用下面来说明这两种情况（方向相同和方向不同）：
![](non_max_sup_md_files%5Cimage%20%282%29.png?v=1&type=image)
图中，C表示中心位置点，斜的直线表示梯度方向（非极大值抑制是在梯度方向上的极大值），**左边的一副表示gy与gx的方向相同，而右边的这幅这表示gy与gx的方向相反（注意原点在左上角）**，而权重则为weight = |gx|/|gy|，因此则根据此种情况，其插值表示则为：
```cpp
dTemp1 = weight*g1 + (1-weight)*g2;
dTemp2 = weight*g3 + (1-weight)*g4;	
```

同理，我们可以得到|gx|>|gy|的情况，此时说明该点的梯度方向更靠近X轴方向，g2和g4则在水平方向，我们可以用下图来说明该种情况：
![](non_max_sup_md_files%5Cimage.png?v=1&type=image)

上图中，C表示中心位置点，斜的直线表示梯度方向（非极大值抑制是在梯度方向上的极大值），左边的一副表示gy与gx的方向相同，而右边的这幅这表示gy与gx的方向相反（注意原点在左上角），而权重则为weight = |gy|/|gx|，因此则根据此种情况，其插值表示则为：    
```cpp   
dTemp1 = weight*g1 + (1-weight)*g2;
dTemp2 = weight*g3 + (1-weight)*g4;	
```
> 通过上面的分析，我们可以了解Canny算子中的**非极大值抑制之前的准备工作，也即进行必要的插值**。
> 插值的原因再啰嗦下：①由于在Canny算子中采用的简化方法来进行边缘方向的确定，自然图像中边缘梯度方向的不一定沿着该四个方向，因此为了找出在一个像素点上最能吻合其所在梯度方向的两侧的像素值，就必须进行必要的插值；② 也由于实际数字图像中的像素点是离散的二维矩阵，处在真正中心位置C处的梯度方向两侧的点是不一定存在的，或者说是一个亚像素(sub pixel)点，而这个不存在的点， 以及这个点的梯度值就必须通过对其两侧的点进行插值来得到。

接下来的工作就比较简单了，就是比较中心位置C处dTemp的梯度幅值与两个插值点处的梯度幅值dTemp1和dTemp2的比较，确定是否为极值点，代码如下：
```cpp 
if(dTemp>=dTemp1 && dTemp>=dTemp2)
{
	pNSRst[nPos] = 128;
}
else
{
	//不可能是边界点
	pNSRst[nPos] = 0;
}
```
————————————————
[原文链接(附代码)](https://blog.csdn.net/kezunhai/article/details/11620357)

---
* 补充：
	* `abs()`对整数去绝对值
	* `fabs()`对浮点数去绝对值 
* 看不懂：

图中，C表示中心位置点，斜的直线表示梯度方向（非极大值抑制是在梯度方向上的极大值），**左边的一副表示gy与gx的方向相同，而右边的这幅这表示gy与gx的方向相反（注意原点在左上角）**，而权重则为weight = |gx|/|gy|，因此则根据此种情况，其插值表示则为：
```cpp
dTemp1 = weight*g1 + (1-weight)*g2;
dTemp2 = weight*g3 + (1-weight)*g4;	
```

